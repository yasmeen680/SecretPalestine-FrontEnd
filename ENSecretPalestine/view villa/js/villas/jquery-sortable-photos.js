!function(t){var i=function(t,i,e,s){this.element=t,this.gridId=i,this.width=e,this.padding=void 0!==s?s:1,this.rows=[]};t.extend(i.prototype,{createRow:function(){var t=this.rows.length,i=new e(t,this.width,this.padding);return this.rows.push(i),i},render:function(){for(var t=0,i=0;i<this.rows.length;i++)this.rows[i].render(t),t+=this.rows[i].height+this.padding;this.element.css("height",t+"px")}});var e=function(t,i,e){this.rowId=t,this.width=i,this.height=0,this.padding=void 0!==e?e:1,this.usedWidth=0,this.items=[]};t.extend(e.prototype,{createItem:function(t,i,e){var h=new s(t);h.width=i,h.height=e,h.displayWidth=i,h.displayHeight=e,h.displayHeight&&h.displayHeight<this.height||!this.height?this.adjustRowHeight(h.height):h=this.fitItem(h),this.items.push(h),this.usedWidth=this.usedWidth+h.displayWidth},isFull:function(){return this.getAvailableWidth()<=0},getAvailableWidth:function(){return this.width-this.usedWidth},fitItem:function(t){if(!t.width||!t.height)return t;var i=t.width/t.height,e=Math.round(i*this.height);return t.displayWidth=e,t.displayHeight=this.height,t},adjustRowHeight:function(t){this.height=t,this.usedWidth=0;for(var i=0;i<this.items.length;i++)if(this.items[i].width&&this.items[i].height){var e=this.items[i].width/this.items[i].height,s=Math.round(e*this.height);this.items[i].displayWidth=s,this.items[i].displayHeight=this.height,this.usedWidth=this.usedWidth+this.items[i].displayWidth}},render:function(t){if(0!=this.items.length){var i,e=this.width-(this.items.length-1)*this.padding;i=e<this.usedWidth?e/this.usedWidth:1,this.height=Math.round(this.height*i);for(var s=0,h=0;h<this.items.length;h++){1!=i&&(this.items[h].displayHeight=this.height,h<this.items.length-1?this.items[h].displayWidth=Math.round(this.items[h].displayWidth*i):this.items[h].displayWidth=this.width-s);var d=this.items[h].element;d.attr("data-row-id",this.rowId),d.css("position","absolute"),d.css("top",t+"px"),d.css("right",s+"px"),d.find("img").css("width",this.items[h].displayWidth+"px"),d.find("img").css("height",this.items[h].displayHeight+"px"),s+=this.items[h].displayWidth+this.padding}}}});var s=function(t){this.element=t,this.width=0,this.height=0,this.displayWidth=0,this.displayHeight=0},h=0;t.widget("glekli.sortablePhotos",{options:{selector:"> *",sortable:!0,padding:2},arrange:function(){this._trigger("beforeArrange",null,this.element);var e=this.element,s=e.width(),h=this.containerId,d=parseInt(this.options.padding),n=e.find(this.options.selector);e.attr("data-jq-sortable-photos-grid-id",h);var r=new i(e,h,s,d),a=r.createRow();n.each(function(i){var e=h+"-"+i,s=t(this);s.attr("data-grid-item-id",e),s.addClass("jq-sortable-photos-item");var d=s.find("img");d.css("height",""),d.css("width",""),d.css("max-width","none"),a.createItem(s,d.width(),d.height()),a.isFull()&&(a=r.createRow())}),r.render()},_getTriggerHandler:function(){var t,i=this;return this._triggerHandler||(this._triggerHandler=function(){t&&clearTimeout(t),t=setTimeout(function(){i.arrange()},100)}),this._triggerHandler},_onDrop:function(i,e){t(e.draggable).detach().insertBefore(i),this.arrange(),this._trigger("afterDrop",null,this.element)},_create:function(){this.containerId=h++;var i=this._getTriggerHandler(),e=this.element.find(this.options.selector),s=this;this.element[0].style.position="relative",this.arrange(),this.options.sortable&&(e.draggable({scope:"jq-sortable-photos-"+this.containerId,stack:".jq-sortable-photos-item",revert:"invalid",opacity:.6,containment:"parent"}),e.droppable({scope:"jq-sortable-photos-"+this.containerId,tolerance:"pointer",drop:function(t,i){s._onDrop(this,i)}})),this.element.find("img").bind("load",i),t(window).bind("resize",i)},destroy:function(){var i=this._getTriggerHandler();t.Widget.prototype.destroy.apply(this,arguments),this.element.find("img").unbind("load",i),t(window).unbind("resize",i)}})}(jQuery);